# GitHub Actions è‡ªåŠ¨éƒ¨ç½²ç¤ºä¾‹

å®Œæ•´çš„ **GitHub Actions è‡ªåŠ¨éƒ¨ç½²å­¦ä¹ é¡¹ç›®**ï¼Œä½¿ç”¨ **Vue 3 + TypeScript + Node.js + Docker + Nginx** æ„å»ºå‰åç«¯åˆ†ç¦»æ¶æ„ã€‚

## ç›®å½•

- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [é¡¹ç›®æ¶æ„](#é¡¹ç›®æ¶æ„)
- [è‡ªåŠ¨éƒ¨ç½²æµç¨‹](#è‡ªåŠ¨éƒ¨ç½²æµç¨‹)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)
- [å­¦ä¹ è¦ç‚¹](#å­¦ä¹ è¦ç‚¹)

---

## æŠ€æœ¯æ ˆ

### å‰ç«¯
| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| **Vue 3** | 3.5.13 | æ¸è¿›å¼ JavaScript æ¡†æ¶ï¼ŒComposition API |
| **TypeScript** | 5.7.2 | ç±»å‹å®‰å…¨å¼€å‘ |
| **Vite** | 6.0.3 | ä¸‹ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…· |
| **Vue Router** | 4.5.0 | Vue.js å®˜æ–¹è·¯ç”±ç®¡ç†å™¨ |
| **Pinia** | 2.2.8 | Vue å®˜æ–¹çŠ¶æ€ç®¡ç†åº“ |

### åç«¯
| æŠ€æœ¯ | è¯´æ˜ |
|------|------|
| **Node.js** | JavaScript è¿è¡Œç¯å¢ƒ |
| **Express** | ç®€æ´çµæ´»çš„ Web æ¡†æ¶ |

### éƒ¨ç½² & CI/CD
| æŠ€æœ¯ | è¯´æ˜ |
|------|------|
| **Docker** | å®¹å™¨åŒ–éƒ¨ç½²ï¼Œå¤šé˜¶æ®µæ„å»º |
| **Nginx** | åå‘ä»£ç†ï¼Œé™æ€æ–‡ä»¶æœåŠ¡ |
| **GitHub Actions** | æŒç»­é›†æˆä¸éƒ¨ç½² |
| **Cloudflare Tunnel** | å†…ç½‘ç©¿é€ï¼ˆæœ¬åœ°éƒ¨ç½²ï¼‰ |
| **Webhook** | è‡ªåŠ¨éƒ¨ç½²è§¦å‘ |

---

## é¡¹ç›®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·æµè§ˆå™¨                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Nginx (ç«¯å£ 80)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   é™æ€æ–‡ä»¶æœåŠ¡      â”‚              â”‚    åå‘ä»£ç†         â”‚    â”‚
â”‚  â”‚   Vue 3 SPA        â”‚              â”‚    /api â†’ åç«¯      â”‚    â”‚
â”‚  â”‚   (æ„å»ºäº§ç‰©)        â”‚              â”‚    :3000            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Node.js åç«¯ (ç«¯å£ 3000)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Express API                                             â”‚  â”‚
â”‚  â”‚  - GET /api      (æ•°æ®æ¥å£)                              â”‚  â”‚
â”‚  â”‚  - GET /health   (å¥åº·æ£€æŸ¥)                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è‡ªåŠ¨éƒ¨ç½²æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¨é€ä»£ç åˆ°    â”‚
â”‚  GitHub ä»“åº“    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Actions â”‚
â”‚  â”œâ”€ æ£€å‡ºä»£ç     â”‚
â”‚  â”œâ”€ æ„å»º Docker â”‚
â”‚  â”œâ”€ è¿è¡Œæµ‹è¯•    â”‚
â”‚  â””â”€ è§¦å‘ Webhookâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare      â”‚
â”‚ Tunnel (å†…ç½‘ç©¿é€)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœ¬åœ°è‡ªåŠ¨æ‰§è¡Œ  â”‚
â”‚  â”œâ”€ git pull   â”‚
â”‚  â”œâ”€ docker buildâ”‚
â”‚  â””â”€ docker up  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    ğŸ‰ éƒ¨ç½²æˆåŠŸï¼
```

---

## é¡¹ç›®ç»“æ„

```
github-deploy-demo/
â”œâ”€â”€ frontend-vue/              # Vue 3 å‰ç«¯å·¥ç¨‹
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/            # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.vue      # é¦–é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ About.vue     # å…³äºé¡µ
â”‚   â”‚   â”œâ”€â”€ stores/           # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ app.ts        # åº”ç”¨çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ router/           # Vue Router è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ index.ts      # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ components/       # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ App.vue           # æ ¹ç»„ä»¶
â”‚   â”‚   â””â”€â”€ main.ts           # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts        # Vite é…ç½®
â”‚   â””â”€â”€ tsconfig.json         # TypeScript é…ç½®
â”‚
â”œâ”€â”€ backend/                   # Node.js åç«¯
â”‚   â”œâ”€â”€ server.js             # Express æœåŠ¡å™¨ï¼ˆçº¯ APIï¼‰
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ nginx/                     # Nginx é…ç½®
â”‚   â””â”€â”€ default.conf          # åå‘ä»£ç† + é™æ€æ–‡ä»¶
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ deploy.yml        # GitHub Actions å·¥ä½œæµ
â”‚
â”œâ”€â”€ webhook-server.js         # Webhook ç›‘å¬æœåŠ¡
â”œâ”€â”€ Dockerfile                # å¤šé˜¶æ®µæ„å»ºé…ç½®
â”œâ”€â”€ docker-compose.yml        # æœ¬åœ°è¿è¡Œé…ç½®
â”œâ”€â”€ AUTO-DEPLOY.md            # è‡ªåŠ¨éƒ¨ç½²è¯¦ç»†æŒ‡å—
â””â”€â”€ README.md                 # æœ¬æ–‡æ¡£
```

---

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šDocker Composeï¼ˆæ¨èï¼‰

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/jiangbkvir/github-deploy-demo.git
cd github-deploy-demo

# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

**è®¿é—®åœ°å€ï¼š**
- å‰ç«¯ï¼šhttp://localhost
- åç«¯ APIï¼šhttp://localhost:3000/api

### æ–¹å¼äºŒï¼šå¼€å‘æ¨¡å¼

```bash
# å‰ç«¯å¼€å‘æœåŠ¡å™¨
cd frontend-vue
npm install
npm run dev

# åç«¯ï¼ˆå¦å¼€ç»ˆç«¯ï¼‰
cd backend
npm install
npm start
```

**å¼€å‘æœåŠ¡å™¨ï¼š** http://localhost:5173

---

## é…ç½®è¯´æ˜

### GitHub Secrets é…ç½®

è®¿é—®ï¼šhttps://github.com/jiangbkvir/github-deploy-demo/settings/secrets/actions

| åç§° | å€¼ | è¯´æ˜ |
|------|-----|------|
| `WEBHOOK_URL` | `xxx.trycloudflare.com` | Cloudflare Tunnel åœ°å€ |
| `WEBHOOK_SECRET` | `my-secret-key` | Webhook å¯†é’¥ |

### æœ¬åœ°è‡ªåŠ¨éƒ¨ç½²é…ç½®

#### 1. å¯åŠ¨ Webhook æœåŠ¡

```bash
node webhook-server.js
```

#### 2. å¯åŠ¨ Cloudflare Tunnel

```bash
cloudflared tunnel --url http://localhost:4000
```

#### 3. æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²

```bash
git add .
git commit -m "test: auto deploy"
git push
```

---

## æ–‡ä»¶è¯´æ˜

### Dockerfileï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰

```dockerfile
# é˜¶æ®µ 1: æ„å»ºå‰ç«¯
FROM node:18-alpine AS frontend-builder
# å®‰è£…ä¾èµ– â†’ æ„å»ºå‰ç«¯

# é˜¶æ®µ 2: æ„å»ºåç«¯
FROM node:18-alpine AS backend-builder
# å®‰è£…ä¾èµ– â†’ å‡†å¤‡åç«¯

# é˜¶æ®µ 3: å‰ç«¯é•œåƒ (Nginx)
FROM nginx:alpine AS frontend
# å¤åˆ¶å‰ç«¯æ„å»ºäº§ç‰©

# é˜¶æ®µ 4: åç«¯é•œåƒ (Node.js)
FROM node:18-alpine AS backend
# å¤åˆ¶åç«¯ä»£ç 
```

**è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ [Dockerfile](./Dockerfile) ä¸­çš„æ³¨é‡Š**

### GitHub Actions å·¥ä½œæµ

```yaml
jobs:
  build-test:
    steps:
      - Checkout ä»£ç 
      - è®¾ç½® Docker Buildx
      - æ„å»º Docker é•œåƒ
      - è¿è¡Œå®¹å™¨æµ‹è¯•
      - è§¦å‘æœ¬åœ°è‡ªåŠ¨éƒ¨ç½²
```

**è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ [.github/workflows/deploy.yml](./.github/workflows/deploy.yml) ä¸­çš„æ³¨é‡Š**

### Nginx é…ç½®

```nginx
location / {
    # å‰ç«¯é™æ€æ–‡ä»¶
    root /usr/share/nginx/html;
    try_files $uri $uri/ /index.html;
}

location /api {
    # åå‘ä»£ç†åˆ°åç«¯
    proxy_pass http://backend:3000;
}
```

---

## å­¦ä¹ è¦ç‚¹

### Docker å¤šé˜¶æ®µæ„å»º

| é˜¶æ®µ | åŸºç¡€é•œåƒ | ç›®çš„ |
|------|----------|------|
| frontend-builder | node:18-alpine | æ„å»ºå‰ç«¯ |
| backend-builder | node:18-alpine | å‡†å¤‡åç«¯ |
| frontend | nginx:alpine | å‰ç«¯è¿è¡Œ |
| backend | node:18-alpine | åç«¯è¿è¡Œ |

**ä¼˜åŠ¿ï¼š**
- é•œåƒä½“ç§¯å°ï¼ˆä¸åŒ…å«æ„å»ºå·¥å…·ï¼‰
- å‰åç«¯ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- æ„å»ºç¼“å­˜ä¼˜åŒ–

### GitHub Actions CI/CD

- **è‡ªåŠ¨æ„å»º**ï¼šæ¯æ¬¡æ¨é€éªŒè¯ Docker é•œåƒ
- **è‡ªåŠ¨æµ‹è¯•**ï¼šè¿è¡Œå¥åº·æ£€æŸ¥
- **è‡ªåŠ¨éƒ¨ç½²**ï¼šé€šè¿‡ Webhook è§¦å‘æœ¬åœ°æ›´æ–°

### Vue 3 æœ€ä½³å®è·µ

- **Composition API**ï¼š`<script setup>` è¯­æ³•
- **TypeScript**ï¼šå®Œæ•´ç±»å‹æ”¯æŒ
- **è·¯ç”±ç®¡ç†**ï¼šVue Router 4
- **çŠ¶æ€ç®¡ç†**ï¼šPinia

### å‰åç«¯åˆ†ç¦»

- **å‰ç«¯**ï¼šNginx é™æ€æ–‡ä»¶æœåŠ¡
- **åç«¯**ï¼šExpress çº¯ API æœåŠ¡
- **é€šä¿¡**ï¼šNginx åå‘ä»£ç†

---

## API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/` | GET | å‰ç«¯é¡µé¢ï¼ˆVue SPAï¼‰ |
| `/about` | GET | å…³äºé¡µé¢ |
| `/api` | GET | è·å–åç«¯æ•°æ® |
| `/health` | GET | å¥åº·æ£€æŸ¥ |

### API å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "message": "ğŸ‰ æ¬¢è¿ä½¿ç”¨ GitHub Actions è‡ªåŠ¨éƒ¨ç½²ï¼å‰åç«¯åˆ†ç¦»ç‰ˆæœ¬",
  "timestamp": "2025/12/23 17:12:42",
  "environment": "production",
  "version": "4.0.0",
  "author": "jiangbkvir",
  "architecture": "Frontend (Nginx) + Backend (Node.js)",
  "features": [
    "Vue 3",
    "TypeScript",
    "Vue Router",
    "Pinia",
    "Vite",
    "Nginx",
    "Docker",
    "GitHub Actions CI/CD"
  ]
}
```

---

## æ‰©å±•å»ºè®®

- [ ] æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆVitestï¼‰
- [ ] æ·»åŠ  E2E æµ‹è¯•ï¼ˆPlaywrightï¼‰
- [ ] æ·»åŠ æ•°æ®åº“ï¼ˆPostgreSQL + Prismaï¼‰
- [ ] é…ç½® HTTPS è¯ä¹¦ï¼ˆLet's Encryptï¼‰
- [ ] æ·»åŠ ç¯å¢ƒå˜é‡ç®¡ç†ï¼ˆdotenvï¼‰
- [ ] é…ç½® CI/CD è´¨é‡é—¨ç¦
- [ ] æ·»åŠ ç›‘æ§å‘Šè­¦ï¼ˆPrometheus + Grafanaï¼‰

---

## å¸¸è§é—®é¢˜

**Q: å¦‚ä½•ä¿®æ”¹ç«¯å£ï¼Ÿ**
A: ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„

**Q: Cloudflare Tunnel åœ°å€å˜äº†ï¼Ÿ**
A: æ›´æ–° GitHub Secret ä¸­çš„ `WEBHOOK_URL`

**Q: æœ¬åœ°å¼€å‘å‰ç«¯å¦‚ä½•è°ƒç”¨åç«¯ï¼Ÿ**
A: Vite å·²é…ç½®ä»£ç†ï¼Œ`/api` è‡ªåŠ¨è½¬å‘åˆ°åç«¯

**Q: å¦‚ä½•æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ï¼Ÿ**
A: `docker-compose logs -f` æˆ–æŸ¥çœ‹ Webhook æœåŠ¡è¾“å‡º

---

## ç›¸å…³æ–‡æ¡£

- [Vue 3 æ–‡æ¡£](https://vuejs.org/)
- [TypeScript æ–‡æ¡£](https://www.typescriptlang.org/)
- [Vite æ–‡æ¡£](https://vitejs.dev/)
- [Docker æ–‡æ¡£](https://docs.docker.com/)
- [Nginx æ–‡æ¡£](https://nginx.org/en/docs/)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [è¯¦ç»†éƒ¨ç½²æŒ‡å—](./AUTO-DEPLOY.md)

---

## è®¸å¯è¯

MIT

---

## ä½œè€…

[jiangbkvir](https://github.com/jiangbkvir)
